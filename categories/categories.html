<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sakura High-End Beauty</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <style>
    /* === CÀI ĐẶT CHUNG & FONT === */
    body {
      font-family: 'Playfair Display', serif;
      background-color: #FFF9F9;
      color: #6B4C3B;
      margin: 10px;
      transition: all 0.3s ease;
      overflow-x: hidden;
      overflow-y: scroll;
    }

    main {
      padding-top: 0px;
      min-height: 60vh;
    }

    /* Fireworks Animation */
    .fireworks-container {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: -1; overflow: hidden;
    }
    .firework-particle {
      position: absolute; width: 80px; height: 80px; border-radius: 50%;
      opacity: 0; will-change: transform, opacity;
      animation: firework-burst 2.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      left: 50%; top: 50%; transform: translate(-50%, -50%) scale(0);
      box-shadow: 0 0 15px rgba(230, 166, 176, 0.7), 0 0 25px rgba(249, 198, 207, 0.4);
      border: 1px solid #E6A6B0;
    }
    .firework-particle.pink-1 { background: linear-gradient(45deg, #E6A6B0, #F9C6CF); }
    .firework-particle.pink-2 { background: linear-gradient(45deg, #F9C6CF, #FFF9F9); }
    .firework-particle.pink-3 { background: linear-gradient(45deg, #FADADD, #E6A6B0); }
    .firework-particle.pink-4 { background: linear-gradient(45deg, #FFF9F9, #FADADD); }
    .firework-particle::after {
      content: ''; position: absolute; top: 50%; left: 50%;
      width: 10px; height: 10px; background: #F9C6CF; border-radius: 50%;
      transform: translate(-50%, -50%) scale(0); animation: sparkle 1.2s ease-in-out infinite;
    }
    @keyframes sparkle {
      0%, 100% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
      50% { transform: translate(-50%, -50%) scale(1); opacity: 0.9; }
    }
    @keyframes firework-burst {
      0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); opacity: 0; }
      10% { opacity: 1; } 50% { opacity: 0.8; }
      100% { transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(0.5) rotate(45deg); opacity: 0; }
    }
    .firework-particle:nth-child(n) { animation-delay: calc(var(--i) * 0.05s); }

    /* === MAIN CONTENT SECTIONS === */
    .category-showcase-section,
    .products-page-container,
    .brand-showcase-section { padding: 40px 20px; box-sizing: border-box; }
    .category-showcase-section h2,
    .products-grid-container h2,
    .brand-showcase-section h2 { font-size: 32px; font-weight: 700; color: #6B4C3B; margin-bottom: 30px; text-align: center; }

    /* Products Page: Sidebar + Grid */
    .products-page-container { 
      width: 95%; max-width: 1600px; margin: 40px auto; 
      display: flex; gap: 30px; align-items: flex-start; 
    }
    .products-filter-sidebar {
      flex: 0 0 260px; position: sticky; top: 150px;
      height: calc(100vh - 170px); overflow-y: auto; padding-right: 15px;
    }
    .products-filter-sidebar::-webkit-scrollbar { width: 5px; }
    .products-filter-sidebar::-webkit-scrollbar-thumb { background-color: rgba(230, 166, 176, 0.4); border-radius: 3px; }
    .products-filter-sidebar::-webkit-scrollbar-track { background-color: transparent; }
    .products-filter-sidebar .filter-header {
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 2px solid #FADADD; padding-bottom: 10px; margin-bottom: 25px;
    }
    .products-filter-sidebar .filter-header h3 { font-size: 20px; color: #6B4C3B; margin: 0; text-transform: uppercase; }
    .products-filter-sidebar .filter-header a { font-size: 13px; color: #aaa; text-decoration: none; transition: color 0.3s ease; }
    .products-filter-sidebar .filter-header a:hover { color: #E6A6B0; }
    .products-filter-sidebar .filter-group { margin-bottom: 30px; }
    .products-filter-sidebar .filter-group h4 { font-size: 16px; font-weight: 600; margin-bottom: 18px; border-bottom: 1px solid #eee; padding-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
    .products-filter-sidebar .filter-tags { display: flex; flex-wrap: wrap; gap: 10px; }
    .products-filter-sidebar .filter-tags .tag { padding: 6px 14px; background: #fff; border: 1px solid #eee; border-radius: 20px; font-size: 13px; cursor: pointer; transition: all 0.3s ease; color: #888; }
    .products-filter-sidebar .filter-tags .tag:hover { background: #fdf5f5; border-color: #FADADD; color: #E6A6B0; }
    .products-filter-sidebar .filter-tags .tag.active { background: #E6A6B0; color: white; border-color: #E6A6B0; }

    .products-grid-container { flex: 1; }
    .products-grid-container h2 { text-align: left; margin-bottom: 10px; }
    .products-grid-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
    .products-grid-header p { font-size: 14px; color: #8c7b7b; margin: 15px; }
    .products-grid-header .sort-by select { padding: 8px 12px; border: 1px solid #eee; border-radius: 8px; background: white; color: #6B4C3B; font-size: 14px; cursor: pointer; outline: none; font-family: 'Playfair Display', serif; }

    /* ================== GRID PRODUCT CARD - ĐÃ CHUYỂN SANG GRID ================== */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 30px;
      width: 100%;
      margin: 0;
      padding: 0;
    }

    /* Product Card - Giữ nguyên style nút, hover, màu */
    .product-card {
      background: #fff;
      border: 1px solid rgba(230, 166, 176, 0.3);
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
      overflow: hidden;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 24px rgba(230, 166, 176, 0.15);
      border-color: #E6A6B0;
    }
    .product-image-container {
      position: relative;
      overflow: hidden;
    }
    .product-img {
      width: 100%;
      height: 260px;
      object-fit: cover;
      display: block;
      transition: opacity 0.4s ease;
    }
    .product-img.hover-image {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      object-fit: cover; opacity: 0; transition: opacity 0.4s ease; z-index: 1;
    }
    .product-card:hover .product-img { opacity: 0; }
    .product-card:hover .hover-image { opacity: 1; }

    .info {
      padding: 16px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .info h3 {
      font-size: 1.1rem;
      margin: 0 0 6px;
      color: #6B4C3B;
      font-family: 'Playfair Display', serif;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .info p {
      font-size: 0.9rem;
      color: #866e6e;
      margin: 4px 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .meta {
      font-size: 0.8rem;
      margin: 4px 0;
      color: #9b7c7c;
    }
    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      padding-top: 10px;
      border-top: 1px solid #f5f5f5;
    }
    .price {
      color: #E6A6B0;
      font-weight: bold;
      font-size: 1.2rem;
    }
    .rating {
      display: flex;
      align-items: center;
      font-size: 0.9rem;
      color: #9b7c7c;
    }
    .star {
      width: 16px;
      height: 16px;
      color: gold;
      margin-right: 3px;
    }
    .buttons {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 12px;
    }
    .quantity-input {
      width: 50px;
      padding: 6px;
      border: 1px solid #eee;
      border-radius: 6px;
      font-family: inherit;
      font-size: 14px;
      color: #6B4C3B;
      text-align: center;
      transition: border-color 0.3s ease;
    }
    .quantity-input:focus {
      border-color: #E6A6B0;
      outline: none;
    }
    .btn-primary {
      border: none;
      background: #E6A6B0;
      color: white;
      border-radius: 8px;
      padding: 10px 16px;
      cursor: pointer;
      font-family: 'Playfair Display', serif;
      font-size: 14px;
      transition: all 0.3s ease;
      flex-grow: 1;
      align-self: flex-start;
    }
    .btn-primary:hover {
      background: #F9C6CF;
      transform: translateY(-2px);
    }
    .btn-outline {
  width: 40px;
  height: 40px;
background: url('../1.homepage/images/shopping.png') no-repeat center center;  background-size: 22px;
  border: 1.5px solid #E6A6B0;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}
.btn-outline:hover {
  background-color: #fdf5f5;
  border-color: #F9C6CF;
  transform: scale(1.1);
}

.btn-view-details {
  flex: 1;
  height: 44px;
  background: linear-gradient(135deg, #E6A6B0, #F9C6CF);
  color: white;
  font-family: 'Playfair Display', serif;
  font-size: 15px;
  font-weight: 600;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(230, 166, 176, 0.3);
  position: relative;
  overflow: hidden;
}
.btn-view-details::after {
  content: '';
  position: absolute;
  top: 50%; left: 50%;
  width: 0; height: 0;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  transition: width 0.4s ease, height 0.4s ease;
}
.btn-view-details:hover {
  background: linear-gradient(135deg, #F9C6CF, #E6A6B0);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(230, 166, 176, 0.4);
}
.btn-view-details:hover::after {
  width: 200px;
  height: 200px;
}
    /* Load More Button */
    .load-more {
      text-align: center;
      margin: 40px 0;
    }
    .load-more .btn-primary {
      font-size: 15px;
      padding: 12px 35px;
      flex-grow: 0;
      border-radius: 25px;
    }

    /* Shop By Category/Brand Cards */
    .category-showcase-section,
    .brand-showcase-section { padding: 40px 20px; }
    .category-showcase-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 30px;
      max-width: 1400px;
      margin: 0 auto;
    }
    .category-showcase-card {
      position: relative; overflow: hidden; border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer; text-decoration: none; display: block;
    }
    .category-showcase-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12); }
    .category-showcase-card img { width: 100%; height: auto; aspect-ratio: 3 / 4; object-fit: cover; display: block; transition: transform 0.4s ease; }
    .category-showcase-card:hover img { transform: scale(1.05); }
    .category-showcase-title {
      position: absolute; bottom: 0; left: 0; width: 100%; padding: 25px;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.8), rgba(0,0,0,0.5), transparent);
      color: white; font-size: 24px; font-weight: 600; text-align: left;
      box-sizing: border-box; text-shadow: 0 1px 3px rgba(0,0,0,0.6);
    }

    /* ================== RESPONSIVE - GRID PRODUCT CARD ================== */
    @media (max-width: 900px) {
      main { padding-top: 50px; }
      .header { padding: 10px 15px; }
      .menu-toggler { display: block !important; width: 28px; height: 28px; z-index: 1011; position: relative; }
      #header-placeholder nav { gap: 10px; }
      #header-placeholder nav a img { width: 26px; height: 26px; }
      .search { margin-left: 8px; margin-right: 8px; max-width: 150px; }
      .search .icon { width: 16px; height: 16px; left: 10px; }
      .search input { padding: 6px 10px 6px 32px; }

      /* Grid: 2 cột */
      .products-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
      }
      .product-card {
        border-radius: 12px;
      }
      .product-img {
        height: 200px;
      }
      .info {
        padding: 12px;
      }
      .info h3 { font-size: 1rem; }
      .price { font-size: 1.1rem; }
      .btn-primary { padding: 8px 12px; font-size: 13px; }
    }

    @media (max-width: 480px) {
      main { padding-top: 50px; }
      .header { padding: 8px 10px; height: 50px; }
      .logo { width: 120px; }
      .menu-toggler { width: 22px; height: 22px; }

      /* Grid: 1 cột */
      .products-grid {
        grid-template-columns: 1fr;
        gap: 15px;
        padding: 0 10px;
      }
      .product-img {
        height: 180px;
      }
      .info {
        padding: 10px;
      }
      .info h3 { font-size: 0.95rem; }
      .price { font-size: 1rem; }
      .btn-primary { padding: 7px 10px; font-size: 12px; }
      .quantity-input { width: 40px; font-size: 12px; }
      .btn-outline { width: 32px; height: 32px; background-size: 18px 18px; }
    }

    /* Style for the product list popup */
    .product-list-popup {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 2001;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }
    .product-list-popup.active {
      display: flex;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; } to { opacity: 1; }
    }
  </style>
</head>
<body>

  <div id="header-placeholder">
    <div style="text-align:center; padding: 20px;">Loading Header...</div>
  </div>

  <main>
    <!-- Nội dung giữ nguyên -->
    <div class="products-page-container">
      <aside class="products-filter-sidebar">
        <div class="filter-header" style="margin-bottom: 0;">
          <h3>FILTER</h3>
          <a href="#">Clear All</a>
        </div>
        <div class="filter-group">
          <h4>CATEGORY</h4>
          <div class="filter-tags">
            <span class="tag active">ALL-IN</span>
            <span class="tag">EYES</span>
            <span class="tag">FACE</span>
            <span class="tag">LIPS</span>
            <span class="tag">PRIMER</span>
            <span class="tag">FRAGRANCE</span>
            <span class="tag">ACCESSORIES & TOOLS</span>
          </div>
        </div>
        <div class="filter-group">
          <h4>BRAND</h4>
          <div class="filter-tags">
            <span class="tag">Dior</span>
            <span class="tag">Chanel</span>
            <span class="tag">Gucci</span>
            <span class="tag">Lancôme</span>
            <span class="tag">Fenty Beauty</span>
          </div>
        </div>
      </aside>

      <section class="products-grid-container">
        <h2 style="text-align: center; margin-bottom: 20px;">All Products</h2>
        <div class="products-grid-header">
          <p>Loading products...</p>
          <div class="sort-by">
            <select>
              <option value="default">SORT BY</option>
              <option value="best-selling">Best Selling</option>
              <option value="price-asc">Price, low to high</option>
              <option value="price-desc">Price, high to low</option>
            </select>
          </div>
        </div>

        <div class="products-grid" id="products-grid">
          <p style="text-align:center;">Loading products...</p>
        </div>

 
      </section>
    </div>

    <hr style="border: none; border-top: 1px solid #FADADD; margin: 40px auto; width: 80%;">

    <!-- Category & Brand Showcase giữ nguyên -->
    <section class="category-showcase-section">
      <h2>Shop By Category</h2>
      <div class="category-showcase-grid">
        <a href="#" class="category-showcase-card">
          <img src="https://via.placeholder.com/400x500/FADADD/6B4C3B?text=Face+Category" alt="Face">
          <span class="category-showcase-title">Face</span>
        </a>
        <a href="#" class="category-showcase-card">
          <img src="https://via.placeholder.com/400x500/FADADD/6B4C3B?text=Eyes+Category" alt="Eyes">
          <span class="category-showcase-title">Eyes</span>
        </a>
        <a href="#" class="category-showcase-card">
          <img src="https://via.placeholder.com/400x500/FADADD/6B4C3B?text=Lips+Category" alt="Lips">
          <span class="category-showcase-title">Lips</span>
        </a>
        <a href="#" class="category-showcase-card">
          <img src="https://via.placeholder.com/400x500/FADADD/6B4C3B?text=Accessories" alt="Accessories & Applicators">
          <span class="category-showcase-title">Accessories & Applicators</span>
        </a>
      </div>
    </section>

    <hr style="border: none; border-top: 1px solid #FADADD; margin: 40px auto; width: 80%;">

    <section class="brand-showcase-section">
      <h2>Shop By Brand</h2>
      <div class="category-showcase-grid">
        <a href="#" class="category-showcase-card">
          <img src="https://via.placeholder.com/400x500/FADADD/6B4C3B?text=Dior+Brand" alt="Dior">
          <span class="category-showcase-title">Dior</span>
        </a>
        <a href="#" class="category-showcase-card">
          <img src="https://via.placeholder.com/400x500/FADADD/6B4C3B?text=Chanel+Brand" alt="Chanel">
          <span class="category-showcase-title">Chanel</span>
        </a>
        <a href="#" class="category-showcase-card">
          <img src="https://via.placeholder.com/400x500/FADADD/6B4C3B?text=Gucci+Brand" alt="Gucci">
          <span class="category-showcase-title">Gucci</span>
        </a>
        <a href="#" class="category-showcase-card">
          <img src="https://via.placeholder.com/400x500/FADADD/6B4C3B?text=Lancome+Brand" alt="Lancôme">
          <span class="category-showcase-title">Lancôme</span>
        </a>
      </div>
    </section>
  </main>

  <div class="product-list-popup" id="productListPopup">
    <div class="product-list-wrapper">
      <button class="product-list-close">&times;</button>
      <h3 class="product-list-title" id="productListTitle">Product List</h3>
      <div class="product-list-items" id="productListItems"></div>
    </div>
  </div>

  <div id="footer-placeholder">
    <div style="text-align:center; padding: 20px;">Loading Footer...</div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {

      // --- 1. Fetch Header and Footer ---
      const loadHTML = async (url, elementId) => {
        const element = document.getElementById(elementId);
        if (!element) {
          console.error(`Placeholder element with id '${elementId}' not found.`);
          return null; // Return null if placeholder doesn't exist
        }
        try {
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error(`Failed to fetch ${url}: ${response.statusText} (${response.status})`);
          }
          const html = await response.text();
          element.innerHTML = html;
          console.log(`${elementId} loaded successfully.`);
          // Return the loaded element itself for potential chaining or height calculation
          return element.firstElementChild; // Assuming the fetched HTML has one top-level element (like <header> or <footer>)
        } catch (error) {
          console.error(`Failed to load HTML for ${elementId}:`, error);
          element.innerHTML = `<p style="color:red; text-align:center;">Error loading content (${url}). Check console.</p>`;
          return null;
        }
      };

      // Use Promise.all to load header and footer concurrently
      const [loadedHeader, loadedFooter] = await Promise.all([
          loadHTML('../header_footer/header.html', 'header-placeholder'),
          loadHTML('../header_footer/footer.html', 'footer-placeholder')
      ]);

      // --- Adjust Main Padding Top after Header Load ---
        function adjustMainPadding() {
            const headerElement = document.querySelector('#header-placeholder > header');
            if (headerElement) {
                const headerHeight = headerElement.offsetHeight;
                const mainElement = document.querySelector('main');
                if (mainElement) {
                    mainElement.style.paddingTop = `${headerHeight + 20}px`; // Add 20px gap
                    console.log(`Adjusted main padding-top to: ${headerHeight + 20}px`);
                }
            } else {
                 console.log("Header element not found yet for padding adjustment, retrying...");
                 // Retry after a short delay if header wasn't ready immediately
                 // Be cautious with recursive calls or infinite loops
                 // setTimeout(adjustMainPadding, 100);
            }
        }

        // Adjust padding immediately after fetch completes *if* header loaded
if (loadedHeader) {
  let retryCount = 0;
  const interval = setInterval(() => {
    adjustMainPadding();
    retryCount++;
    if (retryCount > 10) clearInterval(interval);
  }, 300);
}

        // Also adjust on window resize
        window.addEventListener('resize', adjustMainPadding);


      // --- 2. Fetch Products ---
      async function loadProducts() {
        const grid = document.getElementById('products-grid');
        const productCountEl = document.querySelector('.products-grid-header p'); // Select the count paragraph

        if (!grid || !productCountEl) {
          console.error("Required elements for products ('products-grid' or count paragraph) not found!");
           if(grid) grid.innerHTML = '<p style="color:red;">Error: Product grid element missing.</p>';
          return;
        }

        try {
          const response = await fetch('full.json'); // Ensure 'products.json' is correct
          if (!response.ok) {
            throw new Error(`Failed to fetch products.json: ${response.statusText} (${response.status})`);
          }
          const data = await response.json();

          if (!data || !Array.isArray(data.products)) {
             throw new Error('Invalid JSON structure. Expected an object with a "products" array.');
          }

          let productsHTML = '';
          for (const product of data.products) {
            // Basic validation for product object
            if (!product || typeof product !== 'object' || !product.id || !product.name) {
                console.warn('Skipping invalid product data:', product);
                continue; // Skip this iteration
            }
            // Ensure price and rating are numbers, provide defaults if not
            const price = typeof product.price === 'number' ? product.price : 0;
            const rating = typeof product.rating === 'number' ? product.rating : 0;
            const image = product.image || 'https://via.placeholder.com/300x300/CCC/999?text=No+Image'; // Default image

            productsHTML += `
              <div class="product-card">
                <img src="${image}" alt="${product.name || 'Product'}" class="product-img">
                <div class="info">
                  <h3>${product.name || 'Unnamed Product'}</h3>
                  <p>${product.description || ''}</p>
                  <div class="meta">SKU: ${product.id}</div>
                  <div class="actions">
                    <span class="price">$${price.toFixed(2)}</span>
                    <div class="rating"><i class="fas fa-star star"></i> ${rating.toFixed(1)}</div>
                  </div>
                        <div class="buttons">
                        <input type="number" value="1" min="1" class="quantity-input">
                        <button class="btn-outline" aria-label="Add to cart"></button>
                         <button class="btn-view-details">View Details</button>
                        </div>
                </div>
              </div>
            `;
          }

          grid.innerHTML = productsHTML || '<p>No products found.</p>'; // Handle empty product list
          productCountEl.textContent = `${data.products.length} products`;
          console.log(`Loaded ${data.products.length} products.`);

        } catch (error) {
          console.error('Failed to load products:', error);
          grid.innerHTML = `<p style="color:red; text-align:center;">Error loading products. Check console. (${error.message})</p>`;
          productCountEl.textContent = 'Error';
        }
      }

      await loadProducts(); // Load products after header/footer attempt


      // --- 3. Initialize UI Components (Menu, Search, etc.) ---
      // IMPORTANT: Select elements *after* header/footer have been potentially loaded.
      // Use more robust selection that accounts for elements possibly not being ready yet.

      function initializeUIComponents() {
          console.log("Attempting to initialize UI components...");

          // Select elements *now* after fetch attempts
          const fireworksContainer = document.querySelector('.fireworks-container'); // Might be in header
          const menuToggler = document.getElementById('menu-toggler');
          const navbar = document.getElementById('navbar');
          const announcementWrapper = document.getElementById('announcementWrapper');
          const searchIcon = document.querySelector('#header-placeholder .search .icon'); // Be specific
          const searchInputHeader = document.querySelector('#header-placeholder .search input'); // Be specific
          const productListPopup = document.getElementById('productListPopup');


          // Check if essential elements exist before proceeding
          if (!navbar || !menuToggler || !searchIcon) {
              console.warn("Essential header elements not found yet. UI components might not initialize correctly. Retrying might be needed depending on fetch speed.");
              // Optionally retry initialization after a delay, but be careful
              // setTimeout(initializeUIComponents, 200);
              // return; // Stop initialization for now if critical elements are missing
          } else {
               console.log("Essential elements found. Proceeding with UI initialization.");
          }


          // UI Initialization Logic (Your original code, adapted slightly)
          const navLinks = navbar ? navbar.querySelectorAll(':scope > a:not(.shop-all)') : [];
          const shopAllLink = navbar ? navbar.querySelector(':scope > .shop-all') : null;
          const menuCategories = navbar ? navbar.querySelector('.menu-categories') : null;
          const backBtn = menuCategories ? menuCategories.querySelector('.back-btn') : null;
          const categoryItems = menuCategories ? menuCategories.querySelectorAll('.category') : [];

          // Search Overlay Elements (Create dynamically)
          const searchOverlay = document.createElement('div');
          const searchInputOverlay = document.createElement('input');
          const closeSearchBtn = document.createElement('button');

          // Initialize Fireworks (if container exists)
          if (fireworksContainer) {
            setupFireworks(fireworksContainer);
          } else {
            console.log("Fireworks container not found (might be in header).")
          }

          // Initialize Announcement Slider (if wrapper exists)
          if (announcementWrapper && announcementWrapper.children.length > 1) {
            startAnnouncementSlider(announcementWrapper);
          } else {
            console.log("Announcement wrapper not found or has only one slide.")
          }

          // Initialize Menu Interactions (if navbar elements exist)
          if (navbar && shopAllLink && menuCategories) {
            setupMenuInteractions(navbar, navLinks, shopAllLink, menuCategories, backBtn, categoryItems, menuToggler);
          } else {
              console.warn("Navbar elements missing, cannot initialize menu interactions.");
          }


          // Initialize Search Overlay (if search icon exists)
           if (searchIcon) {
                setupSearchOverlay(searchOverlay, searchInputOverlay, closeSearchBtn, searchIcon, searchInputHeader);
           } else {
               console.warn("Search icon missing, cannot initialize search overlay.");
           }


          // Initialize Product List Popup (if it exists)
          if(productListPopup) {
            const productListPopupCloseBtn = productListPopup.querySelector('.product-list-close'); // Select close button inside
            setupProductListPopup(productListPopup, productListPopupCloseBtn);
          } else {
              console.log("Product list popup not found.");
          }

      }

      // Call the initialization function *after* fetch attempts
       initializeUIComponents();


      // ============================================
      // === FUNCTIONS (Your original functions, pass elements as arguments) ===
      // ============================================

      function setupFireworks(container) { // Pass container
        const colors = ['pink-1', 'pink-2', 'pink-3', 'pink-4'];
        const numParticles = window.innerWidth > 768 ? 60 : 30;
        if (!container) return;
        while (container.firstChild) {
          container.removeChild(container.firstChild);
        }
        for (let i = 0; i < numParticles; i++) {
          const particle = document.createElement('div');
          particle.classList.add('firework-particle', colors[Math.floor(Math.random() * colors.length)]);
          particle.style.setProperty('--tx', `${Math.random() * 150 - 75}vw`);
          particle.style.setProperty('--ty', `${Math.random() * 150 - 75}vh`);
          particle.style.setProperty('--i', i);
          container.appendChild(particle);
          particle.addEventListener('animationend', function handler() {
            if (particle.parentNode === container) {
              container.removeChild(particle);
            }
            particle.removeEventListener('animationend', handler);
          }, { once: true });
        }
         console.log("Fireworks setup complete.");
      }

      function startAnnouncementSlider(wrapper) { // Pass wrapper
        let currentSlide = 0;
        const slides = wrapper.children;
        const intervalTime = 3000;
        let slideInterval;
        function nextSlide() {
          if (!slides || slides.length <= 1) { // Check length > 1
            clearInterval(slideInterval);
            return;
          }
          currentSlide = (currentSlide + 1) % slides.length;
          wrapper.style.transform = `translateX(-${currentSlide * 100}%)`;
        }
        if (slides.length > 1) {
          slideInterval = setInterval(nextSlide, intervalTime);
          wrapper.addEventListener('mouseenter', () => clearInterval(slideInterval));
          wrapper.addEventListener('mouseleave', () => {
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, intervalTime);
          });
          console.log("Announcement slider started.");
        }
      }

      function setupMenuInteractions(navbar, navLinks, shopAllLink, menuCategories, backBtn, categoryItems, menuToggler) { // Pass elements
         if (!navbar || !shopAllLink || !menuCategories || !menuToggler) {
            console.error("Cannot setup menu interactions - essential elements missing.");
            return;
         }
        let pcMenuTimeoutId;
        let isMobile = window.innerWidth <= 900;

        const showPcMenu = () => { /* ... (keep original logic) ... */
             if (isMobile) return;
            clearTimeout(pcMenuTimeoutId);
            menuCategories.style.display = 'block';
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                menuCategories.style.opacity = '1';
                menuCategories.style.visibility = 'visible';
                menuCategories.style.transform = 'translateY(0)';
                });
            });
         };
        const hidePcMenu = () => { /* ... (keep original logic) ... */
             if (isMobile) return;
            clearTimeout(pcMenuTimeoutId);
            pcMenuTimeoutId = setTimeout(() => {
                menuCategories.style.opacity = '0';
                menuCategories.style.visibility = 'hidden';
                menuCategories.style.transform = 'translateY(-10px)';
                const transitionEndHandler = () => {
                if (menuCategories.style.opacity === '0') {
                    menuCategories.style.display = 'none';
                }
                menuCategories.removeEventListener('transitionend', transitionEndHandler);
                };
                menuCategories.removeEventListener('transitionend', transitionEndHandler);
                menuCategories.addEventListener('transitionend', transitionEndHandler, { once: true });
            }, 150);
        };
        const handleMobileCategoryClick = (e) => { /* ... (keep original logic) ... */
             if (!isMobile) return;
            e.preventDefault();
            e.stopPropagation();
            menuCategories.classList.add('active');
            if (backBtn) backBtn.style.display = 'flex';
            navLinks.forEach(link => link.style.display = 'none');
            shopAllLink.style.display = 'none';
        };
        const handleMobileBackClick = (e) => { /* ... (keep original logic) ... */
             if (!isMobile || !backBtn) return; // Added check for backBtn
            e.stopPropagation();
            menuCategories.style.animation = 'slideOutRight 0.4s ease forwards';
            menuCategories.addEventListener('animationend', function handler() {
                menuCategories.classList.remove('active');
                 if (backBtn) backBtn.style.display = 'none'; // Check again
                navLinks.forEach(link => link.style.display = 'block');
                shopAllLink.style.display = 'flex';
                categoryItems.forEach(cat => {
                cat.classList.remove('active');
                const productList = cat.querySelector('.product-list');
                if (productList) productList.style.display = 'none';
                });
                menuCategories.style.animation = '';
                menuCategories.removeEventListener('animationend', handler);
            }, { once: true });
        };
        const toggleMobileSubList = (e) => { /* ... (keep original logic) ... */
            if (!isMobile) return;
            e.stopPropagation();
            const categoryItem = e.currentTarget.closest('.category');
            if (!categoryItem) return;

            const isActive = categoryItem.classList.toggle('active');
            const productList = categoryItem.querySelector('.product-list');

            categoryItems.forEach(otherItem => {
                if (otherItem !== categoryItem && otherItem.classList.contains('active')) {
                otherItem.classList.remove('active');
                const otherList = otherItem.querySelector('.product-list');
                if (otherList) otherList.style.display = 'none';
                }
            });

            if (productList) {
                productList.style.display = isActive ? 'block' : 'none';
            }
        };
        const closeMobileNav = () => { /* ... (keep original logic) ... */
             if (navbar && navbar.classList.contains('active')) {
                navbar.classList.remove('active');
                document.body.style.overflow = '';
                if (menuCategories) menuCategories.classList.remove('active');
                 if (backBtn) backBtn.style.display = 'none'; // Check if backBtn exists
                navLinks.forEach(link => link.style.display = 'block');
                if (shopAllLink) shopAllLink.style.display = 'flex';
                categoryItems.forEach(cat => {
                cat.classList.remove('active');
                const productList = cat.querySelector('.product-list');
                if (productList) productList.style.display = 'none';
                });
            }
        };

        const setupDesktopListeners = () => { /* ... (keep original logic, ensure elements exist) ... */
            if (!shopAllLink || !menuCategories) return;
            shopAllLink.addEventListener('mouseenter', showPcMenu);
            shopAllLink.addEventListener('mouseleave', hidePcMenu);
            menuCategories.addEventListener('mouseenter', showPcMenu);
            menuCategories.addEventListener('mouseleave', hidePcMenu);
            shopAllLink.removeEventListener('click', handleMobileCategoryClick);
            if (backBtn) backBtn.removeEventListener('click', handleMobileBackClick);
            categoryItems.forEach(item => {
                const header = item.querySelector('.category-header');
                if (header && header.mobileClickHandler) {
                    header.removeEventListener('click', header.mobileClickHandler);
                    delete header.mobileClickHandler;
                }
            });
             if (backBtn) backBtn.style.display = 'none'; // Check if backBtn exists
            navLinks.forEach(link => link.style.display = 'inline-block');
            shopAllLink.style.display = 'inline-block';
            menuCategories.classList.remove('active');
             // Reset styles carefully, check if menuCategories exists
            if (menuCategories) {
                menuCategories.style.position = 'absolute';
                menuCategories.style.height = '';
                menuCategories.style.left = '';
                menuCategories.style.width = '100vw';
                menuCategories.style.marginLeft = 'calc(-50vw + 50%)';
                // Reset display/opacity if hidden by mobile logic
                menuCategories.style.display = 'none';
                menuCategories.style.opacity = '0';
                menuCategories.style.visibility = 'hidden';
                menuCategories.style.transform = 'translateY(-10px)';
            }
            categoryItems.forEach(cat => {
                cat.classList.remove('active');
                const productList = cat.querySelector('.product-list');
                if (productList) productList.style.display = 'block';
            });
            closeMobileNav();
        };
        const removeDesktopListeners = () => { /* ... (keep original logic, ensure elements exist) ... */
             if (!shopAllLink || !menuCategories) return;
            shopAllLink.removeEventListener('mouseenter', showPcMenu);
            shopAllLink.removeEventListener('mouseleave', hidePcMenu);
            menuCategories.removeEventListener('mouseenter', showPcMenu);
            menuCategories.removeEventListener('mouseleave', hidePcMenu);
            clearTimeout(pcMenuTimeoutId);
             if (menuCategories) { // Check if menuCategories exists
                menuCategories.style.display = 'none';
                menuCategories.style.opacity = '0';
                menuCategories.style.visibility = 'hidden';
                menuCategories.style.transform = 'translateY(-10px)';
            }
        };
        const setupMobileListeners = () => { /* ... (keep original logic, ensure elements exist) ... */
             if (!shopAllLink || !menuCategories) return;
            shopAllLink.addEventListener('click', handleMobileCategoryClick);
            if (backBtn) backBtn.addEventListener('click', handleMobileBackClick);
            categoryItems.forEach(item => {
                const header = item.querySelector('.category-header');
                if (header) {
                header.mobileClickHandler = toggleMobileSubList;
                header.addEventListener('click', header.mobileClickHandler);
                }
                const productList = item.querySelector('.product-list');
                if (productList) productList.style.display = 'none';
            });
             if (menuCategories) { // Check if menuCategories exists
                // Ensure correct initial state for mobile animation
                menuCategories.style.display = 'none'; // Will be shown by .active class
                menuCategories.style.opacity = '1';
                menuCategories.style.visibility = 'visible';
                menuCategories.style.transform = 'none';
                menuCategories.style.position = 'absolute';
                menuCategories.style.height = '100%';
                menuCategories.style.left = '0';
                menuCategories.style.width = '100%';
                menuCategories.style.marginLeft = '0';
             }
        };
        const removeMobileListeners = () => { /* ... (keep original logic, ensure elements exist) ... */
             if (!shopAllLink || !menuCategories) return;
            shopAllLink.removeEventListener('click', handleMobileCategoryClick);
            if (backBtn) backBtn.removeEventListener('click', handleMobileBackClick);
            categoryItems.forEach(item => {
                const header = item.querySelector('.category-header');
                if (header && header.mobileClickHandler) {
                header.removeEventListener('click', header.mobileClickHandler);
                delete header.mobileClickHandler;
                }
            });
            if (menuCategories) menuCategories.classList.remove('active'); // Check if menuCategories exists
        };

        const handleResize = () => { /* ... (keep original logic) ... */
             const newIsMobile = window.innerWidth <= 900;
            if (newIsMobile !== isMobile) {
                isMobile = newIsMobile;
                removeDesktopListeners();
                removeMobileListeners();
                if (isMobile) {
                setupMobileListeners();
                } else {
                setupDesktopListeners();
                }
            }
            if (!isMobile) {
                closeMobileNav();
            }
        };

        // --- Event Listeners ---
        // Menu Toggler
         if (menuToggler) { // Check if menuToggler exists
            menuToggler.addEventListener('click', (e) => {
                e.stopPropagation();
                if (!isMobile || !navbar) return; // Check navbar too

                const isActive = navbar.classList.toggle('active');
                document.body.style.overflow = isActive ? 'hidden' : '';
                if (!isActive && menuCategories && backBtn) {
                menuCategories.classList.remove('active');
                backBtn.style.display = 'none';
                navLinks.forEach(link => link.style.display = 'block');
                if (shopAllLink) shopAllLink.style.display = 'flex';
                categoryItems.forEach(cat => {
                    cat.classList.remove('active');
                    const productList = cat.querySelector('.product-list');
                    if (productList) productList.style.display = 'none';
                });
                }
            });
         }


        // Click outside mobile nav
        document.addEventListener('click', (e) => {
          if (isMobile && navbar && navbar.classList.contains('active') && !navbar.contains(e.target) && menuToggler && !menuToggler.contains(e.target) && e.target !== menuToggler) {
            closeMobileNav();
          }
        });

        // Resize Listener
        let resizeTimer;
        window.addEventListener('resize', () => {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(handleResize, 100);
        });

        // --- Initial Setup Call ---
        if (isMobile) {
          setupMobileListeners();
        } else {
          setupDesktopListeners();
        }
        console.log("Menu interactions setup complete.");
      }


        function setupSearchOverlay(searchOverlay, searchInputOverlay, closeSearchBtn, searchIcon, searchInputHeader) { // Pass elements
            if (!searchIcon) {
                console.error("Search icon not found, cannot initialize search overlay.");
                return;
            }
            // Style and append overlay elements
            searchOverlay.classList.add('search-overlay');
            searchInputOverlay.classList.add('search-input');
            searchInputOverlay.placeholder = 'Search here...';
            searchInputOverlay.setAttribute('type', 'search');
            closeSearchBtn.classList.add('close-search');
            closeSearchBtn.innerHTML = '&times;';
            closeSearchBtn.setAttribute('aria-label', 'Close search');
            searchOverlay.appendChild(searchInputOverlay);
            searchOverlay.appendChild(closeSearchBtn);
            document.body.appendChild(searchOverlay); // Append to body

            const openSearch = (e) => { /* ... (keep original logic) ... */
                if (e) e.stopPropagation();
                searchOverlay.classList.add('active');
                setTimeout(() => searchInputOverlay.focus(), 50);
                document.body.style.overflow = 'hidden';
            };
            const closeSearch = () => { /* ... (keep original logic) ... */
                 searchOverlay.classList.remove('active');
                 document.body.style.overflow = '';
            };

            // Attach listeners
            searchIcon.addEventListener('click', openSearch);
            if (searchInputHeader) {
                searchInputHeader.addEventListener('click', (e) => { if (window.innerWidth <= 900) { e.preventDefault(); openSearch(e); } });
                searchInputHeader.addEventListener('focus', (e) => { if (window.innerWidth <= 900) { e.target.blur(); openSearch(e); } });
            }
            closeSearchBtn.addEventListener('click', closeSearch);
            searchOverlay.addEventListener('click', (e) => { if (e.target === searchOverlay) { closeSearch(); } });
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && searchOverlay.classList.contains('active')) { closeSearch(); } });
             // Sync input (optional)
             searchInputOverlay.addEventListener('input', () => {
                 if (searchInputHeader) { searchInputHeader.value = searchInputOverlay.value; }
             });
             console.log("Search overlay setup complete.");
        }


        function setupProductListPopup(popupElement, closeButton) { // Pass elements
            if (!popupElement) {
                console.log("Product list popup element not found.");
                return;
            }
             // Make the global functions available
            window.showProductList = function(brandOrCategory) {
                 const title = popupElement.querySelector('.product-list-title');
                 const itemsContainer = popupElement.querySelector('.product-list-items');
                 if (!title || !itemsContainer) {
                     console.error("Popup title or items container not found.");
                     return;
                 }
                 title.textContent = `${brandOrCategory} Products`;
                 // --- Example data loading ---
                 const sampleProducts = [ /* ... (your sample data) ... */
                     { name: `${brandOrCategory} Item 1`, price: '$25.99', img: 'https://via.placeholder.com/200x200/FADADD/6B4C3B?text=Item+1' },
                     { name: `${brandOrCategory} Item 2`, price: '$30.50', img: 'https://via.placeholder.com/200x200/FADADD/6B4C3B?text=Item+2' }
                 ];
                 itemsContainer.innerHTML = sampleProducts.map(product => `
                     <div class="product-list-item" onclick="window.location.href='#'">
                     <img src="${product.img}" alt="${product.name}" loading="lazy"> <h4>${product.name}</h4>
                     <p class="price">${product.price}</p>
                     </div>
                 `).join('');
                 popupElement.classList.add('active');
                 document.body.style.overflow = 'hidden';
            };

             window.closeProductList = function() { // Make close function global
                 if (popupElement) {
                     popupElement.classList.remove('active');
                     document.body.style.overflow = '';
                 }
             };

             // Attach listeners if close button exists
             if (closeButton) {
                 closeButton.addEventListener('click', window.closeProductList);
             } else {
                 console.warn("Product list popup close button not found.");
             }
             popupElement.addEventListener('click', (e) => {
                 if (e.target === popupElement) window.closeProductList(); // Close on background click
             });
             document.addEventListener('keydown', (e) => {
                 if (e.key === 'Escape' && popupElement.classList.contains('active')) {
                     window.closeProductList(); // Close on Escape key
                 }
             });
              console.log("Product list popup setup complete.");
        }


    }); // <-- End of DOMContentLoaded
  </script>

</body>
</html>