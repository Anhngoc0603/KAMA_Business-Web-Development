<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Details </title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    :root {
      --primary-color: #E6A6B0;
      --secondary-color: #F9C6CF;
      --accent-color: #6B4C3B;
      --background-color: #FFF9F9;
      --text-color: #6B4C3B;
      --text-light: #9b7c7c;
      --shadow-soft: 0 8px 32px rgba(107, 76, 59, 0.08);
      --shadow-medium: 0 12px 40px rgba(107, 76, 59, 0.12);
      --shadow-strong: 0 20px 60px rgba(107, 76, 59, 0.18);
      --gradient-pink: linear-gradient(135deg, #E6A6B0, #F9C6CF);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Playfair Display', serif;
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.7;
      font-size: 18px; /* Tăng kích thước chữ toàn bộ */
    }

    .product-page {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 50px;
      max-width: 1200px;
      margin: 0 auto 60px;
      padding: 40px 30px;
      align-items: start;
    }

    .product-gallery {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .gallery-main {
      width: 100%;
      height: 500px;
      border-radius: 20px;
      overflow: hidden;
      position: relative;
      box-shadow: var(--shadow-medium);
    }

    .gallery-main img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .gallery-thumbnails {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .thumbnail {
      width: 70px;
      height: 70px;
      border-radius: 12px;
      object-fit: cover;
      cursor: pointer;
      opacity: 0.7;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .thumbnail.active,
    .thumbnail:hover {
      opacity: 1;
      border-color: var(--primary-color);
    }

    .product-details {
      padding: 20px 0;
    }

    .product-title {
      font-size: 48px; /* Tăng kích thước */
      font-weight: 700;
      color: var(--text-color);
      margin-bottom: 12px;
      line-height: 1.2;
    }

    .product-brand {
      color: var(--text-light);
      font-size: 22px; /* Tăng kích thước */
      margin-bottom: 10px;
      font-style: italic;
    }

    .product-rating {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      gap: 10px;
    }

    .rating-stars {
      color: #ffc107;
      font-size: 20px; /* Tăng kích thước */
    }

    .rating-value {
      color: var(--text-light);
      font-size: 18px; /* Tăng kích thước */
    }

    .new-arrival {
      color: var(--primary-color);
      font-weight: 600;
      margin-bottom: 20px;
      display: inline-block;
      padding: 8px 12px; /* Tăng padding */
      background: rgba(230, 166, 176, 0.1);
      border-radius: 6px;
      font-size: 18px; /* Tăng kích thước */
    }

    .product-pricing {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .original-price {
      text-decoration: line-through;
      color: var(--text-light);
      font-size: 22px; /* Tăng kích thước */
    }

    .sale-price {
      font-size: 32px; /* Tăng kích thước */
      font-weight: bold;
      color: var(--primary-color);
    }

    .shipping-note {
      color: var(--text-light);
      margin-bottom: 20px;
      font-size: 18px; /* Tăng kích thước */
    }

    .product-options {
      margin-bottom: 20px;
    }

    .product-options label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 18px; /* Tăng kích thước */
    }

    .product-options select {
      width: 100%;
      padding: 14px 16px; /* Tăng padding */
      border: 2px solid rgba(230, 166, 176, 0.3);
      border-radius: 10px;
      background: white;
      font-family: 'Playfair Display', serif;
      font-size: 18px; /* Tăng kích thước */
    }

    .product-description {
      margin-bottom: 25px;
      line-height: 1.8;
      font-size: 18px; /* Tăng kích thước */
    }

    .quantity-selector {
      display: flex;
      align-items: center;
      margin-bottom: 25px;
      width: 150px;
      border: 1px solid #ddd;
      border-radius: 5px;
      overflow: hidden;
    }

    .quantity-btn {
      width: 40px;
      height: 40px;
      background: #f5f5f5;
      border: none;
      font-size: 20px; /* Tăng kích thước */
      cursor: pointer;
    }

    #quantity {
      width: 70px;
      height: 40px;
      text-align: center;
      border: none;
      border-left: 1px solid #ddd;
      border-right: 1px solid #ddd;
      font-family: 'Playfair Display', serif;
      font-size: 18px; /* Tăng kích thước */
    }

    .btn-primary {
      width: 50%;
      padding: 16px; /* Tăng padding */
      background: var(--gradient-pink);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px; /* Tăng kích thước */
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Playfair Display', serif;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .product-info-enhanced {
      max-width: 1200px;
      margin: 60px auto;
      padding: 0 20px;
    }

    .info-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(107, 76, 59, 0.08);
      border: 1px solid rgba(230, 166, 176, 0.2);
      animation: fadeInUp 0.6s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .section-header {
      display: flex;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 2px solid #FADADD;
    }

    .section-icon {
      width: 50px; /* Tăng kích thước */
      height: 50px; /* Tăng kích thước */
      background: var(--gradient-pink);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      color: white;
      font-size: 22px; /* Tăng kích thước */
    }

    .section-title {
      font-size: 32px; /* Tăng kích thước */
      font-weight: 700;
      color: #6B4C3B;
      margin: 0;
    }

    /* Rating Breakdown Section */
    .rating-breakdown {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(107, 76, 59, 0.08);
      border: 1px solid rgba(230, 166, 176, 0.2);
      animation: fadeInUp 0.6s ease-out;
    }

    .rating-overview {
      display: flex;
      align-items: center;
      gap: 30px;
      margin-bottom: 30px;
    }

    .rating-score {
      text-align: center;
    }

    .rating-number {
      font-size: 56px; /* Tăng kích thước */
      font-weight: 700;
      color: #6B4C3B;
      line-height: 1;
    }

    .rating-stars-large {
      font-size: 24px; /* Tăng kích thước */
      color: #ffc107;
      margin: 10px 0;
    }

    .rating-count {
      color: var(--text-light);
      font-size: 18px; /* Tăng kích thước */
    }

    .rating-bars {
      flex: 1;
    }

    .rating-bar {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }

    .rating-label {
      width: 80px;
      font-size: 18px; /* Tăng kích thước */
      color: var(--text-light);
    }

    .rating-bar-container {
      flex: 1;
      height: 10px; /* Tăng chiều cao */
      background: #f0f0f0;
      border-radius: 5px;
      overflow: hidden;
      margin: 0 10px;
    }

    .rating-bar-fill {
      height: 100%;
      background: var(--gradient-pink);
      border-radius: 5px;
      transition: width 1.5s ease-out;
    }

    .rating-percentage {
      width: 40px;
      font-size: 18px; /* Tăng kích thước */
      color: var(--text-light);
      text-align: right;
    }

    .rating-summary {
      margin-top: 30px;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(230, 166, 176, 0.2);
    }

    .summary-label {
      font-weight: 600;
      color: #6B4C3B;
      font-size: 18px; /* Tăng kích thước */
    }

    .summary-value {
      color: var(--text-light);
      font-size: 18px; /* Tăng kích thước */
    }

    /* Benefits Grid */
    .benefits-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-top: 20px;
    }

    .benefit-card {
      background: linear-gradient(135deg, #FFF9F9, #FFF0F2);
      padding: 25px;
      border-radius: 15px;
      border-left: 4px solid #E6A6B0;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .benefit-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s ease;
    }

    .benefit-card:hover::before {
      left: 100%;
    }

    .benefit-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(230, 166, 176, 0.2);
    }

    .benefit-icon {
      font-size: 28px; /* Tăng kích thước */
      color: #E6A6B0;
      margin-bottom: 15px;
    }

    .benefit-title {
      font-size: 22px; /* Tăng kích thước */
      font-weight: 600;
      color: #6B4C3B;
      margin-bottom: 15px;
    }

    .benefit-description {
      color: #8c7b7b;
      line-height: 1.6;
      font-size: 18px; /* Tăng kích thước */
    }

    /* Ingredients List */
    .ingredients-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .ingredient-item {
      background: rgba(255, 255, 255, 0.8);
      padding: 25px; /* Tăng padding */
      border-radius: 12px;
      border: 1px solid rgba(230, 166, 176, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .ingredient-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(230, 166, 176, 0.05), rgba(249, 198, 207, 0.05));
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .ingredient-item:hover::before {
      opacity: 1;
    }

    .ingredient-item:hover {
      background: white;
      box-shadow: 0 5px 20px rgba(230, 166, 176, 0.15);
      transform: translateY(-2px);
    }

    .ingredient-name {
      font-weight: 600;
      color: #6B4C3B;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 20px; /* Tăng kích thước */
    }

    .ingredient-name::before {
      content: '✦';
      color: #E6A6B0;
      font-size: 18px; /* Tăng kích thước */
    }

    .ingredient-purpose {
      color: #8c7b7b;
      font-size: 18px; /* Tăng kích thước */
      line-height: 1.5;
    }

    /* Features List */
    .features-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
    }

    .feature-item {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    .feature-item:hover {
      background: white;
      transform: translateX(10px);
    }

    .feature-badge {
      background: var(--gradient-pink);
      color: white;
      width: 28px; /* Tăng kích thước */
      height: 28px; /* Tăng kích thước */
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px; /* Tăng kích thước */
      font-weight: bold;
      flex-shrink: 0;
    }

    .feature-content h4 {
      margin: 0 0 5px 0;
      color: #6B4C3B;
      font-size: 18px; /* Tăng kích thước */
    }

    .feature-content p {
      margin: 0;
      color: #8c7b7b;
      font-size: 16px; /* Tăng kích thước */
      line-height: 1.5;
    }

    /* Reviews Section */
    .reviews-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(107, 76, 59, 0.08);
      border: 1px solid rgba(230, 166, 176, 0.2);
      animation: fadeInUp 0.6s ease-out;
    }

    .reviews-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 2px solid #FADADD;
    }

    .reviews-average {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 28px; /* Tăng kích thước */
      font-weight: 600;
      color: #6B4C3B;
    }

    .reviews-count {
      color: var(--text-light);
      font-size: 18px; /* Tăng kích thước */
    }

    .review-item {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
      border-left: 4px solid var(--primary-color);
      transition: all 0.3s ease;
    }

    .review-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(230, 166, 176, 0.1);
    }

    .review-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--gradient-pink);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      flex-shrink: 0;
      font-size: 20px; /* Tăng kích thước */
    }

    .review-content {
      flex: 1;
    }

    .review-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .review-name {
      font-weight: 600;
      color: #6B4C3B;
      font-size: 18px; /* Tăng kích thước */
    }

    .review-date {
      color: var(--text-light);
      font-size: 16px; /* Tăng kích thước */
    }

    .review-stars {
      color: #ffc107;
      font-size: 16px; /* Tăng kích thước */
    }

    .review-text {
      line-height: 1.6;
      margin-bottom: 10px;
      font-size: 18px; /* Tăng kích thước */
    }

    .review-helpful {
      color: var(--text-light);
      font-size: 16px; /* Tăng kích thước */
    }

    /* ===== ANIMATIONS ===== */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .animate-pulse {
      animation: pulse 2s infinite;
    }

    .animate-slide-left {
      animation: slideInLeft 0.6s ease-out;
    }

    .animate-slide-right {
      animation: slideInRight 0.6s ease-out;
    }

    /* ===== RESPONSIVE IMPROVEMENTS ===== */
    @media (max-width: 900px) {
      .product-page {
        grid-template-columns: 1fr;
        gap: 30px;
        padding: 20px 15px;
      }
      
      .gallery-main {
        height: 400px;
      }

      .reviews-item {
        flex-direction: column;
        gap: 15px;
      }

      .review-avatar {
        align-self: flex-start;
      }

      .rating-overview {
        flex-direction: column;
        text-align: center;
      }

      .rating-bars {
        width: 100%;
      }
    }

    @media (max-width: 768px) {
      .product-info-enhanced,
      .reviews-section,
      .rating-breakdown {
        padding: 0 15px;
      }
      
      .info-section,
      .reviews-section,
      .rating-breakdown {
        padding: 25px 20px;
        margin-bottom: 20px;
      }
      
      .section-title {
        font-size: 28px;
      }
      
      .benefits-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .benefit-card {
        padding: 20px;
      }
      
      .ingredients-list {
        grid-template-columns: 1fr;
      }
      
      .feature-item {
        padding: 12px;
      }

      .benefit-title {
        font-size: 20px;
      }

      .benefit-description {
        font-size: 17px;
      }

      .ingredient-name {
        font-size: 18px;
      }

      .ingredient-purpose {
        font-size: 17px;
      }

      .product-title {
        font-size: 36px;
      }

      .product-brand {
        font-size: 18px;
      }
    }

    @media (max-width: 480px) {
      .info-section,
      .reviews-section,
      .rating-breakdown {
        padding: 20px 15px;
      }
      
      .section-header {
        flex-direction: column;
        text-align: center;
        gap: 10px;
      }
      
      .section-icon {
        margin-right: 0;
      }

      .reviews-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .rating-number {
        font-size: 42px;
      }

      .product-title {
        font-size: 32px;
      }
    }
  </style>
</head>
<body>
  <!-- Header Placeholder -->
  <div id="header-placeholder">
    <div class="loading">
      <div class="spinner"></div>
      <span>Loading header...</span>
    </div>
  </div>

  <!-- Product Page Content -->
  <main class="product-page" id="productPage">
    <div class="loading">
      <div class="spinner"></div>
      <p>Đang tải thông tin sản phẩm...</p>
    </div>
  </main>

  <!-- Product Info Sections -->
  <div class="product-info-enhanced" id="productInfoEnhanced">
    <!-- Sections will be dynamically inserted here -->
  </div>

  <!-- Footer Placeholder -->
  <div id="footer-placeholder">
    <div class="loading">
      <div class="spinner"></div>
      <span>Loading footer...</span>
    </div>
  </div>

  <script>
    // ==================== DEBUG MODE ====================
    const DEBUG = true;

    // ==================== CONFIGURATION ====================
    const CONFIG = {
      // Thử các đường dẫn khác nhau
      jsonPaths: [
        'full.json'
      ],
      headerPath: './header.html',
      footerPath: './footer.html',
      productsPage: '../new/new.html'
    };

    // ==================== UTILITY FUNCTIONS ====================
    function debugLog(message, data = null) {
      if (DEBUG) {
        console.log(`🔍 ${message}`, data || '');
      }
    }

    function showError(message, details = '') {
      console.error('❌ Lỗi:', message, details);
      const productPage = document.getElementById('productPage');
      productPage.innerHTML = `
        <div class="error-message">
          <h2>Lỗi khi tải trang</h2>
          <p>${message}</p>
          ${details ? `<div class="debug-info"><strong>Chi tiết:</strong> ${details}</div>` : ''}
          <div class="debug-info">
            <strong>URL hiện tại:</strong> ${window.location.href}<br>
            <strong>Product ID từ URL:</strong> ${new URLSearchParams(window.location.search).get('id') || 'Không có'}
          </div>
          <a href="${CONFIG.productsPage}">← Quay lại trang sản phẩm</a>
        </div>
      `;
    }

    function showLoading() {
      const productPage = document.getElementById('productPage');
      productPage.innerHTML = `
        <div class="loading" style="grid-column: 1 / -1;">
          <div class="spinner"></div>
          <p>Đang tải thông tin sản phẩm...</p>
        </div>
      `;
    }

    // ==================== CORE FUNCTIONS ====================
    function getProductIdFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get('id');
      
      debugLog('Product ID từ URL:', productId);
      
      if (!productId) {
        showError('Thiếu thông tin sản phẩm', 'Không tìm thấy ID sản phẩm trong URL');
        return null;
      }
      
      return productId;
    }

    async function tryFetchMultiplePaths(paths) {
      for (const path of paths) {
        try {
          debugLog('Thử tải từ đường dẫn:', path);
          const response = await fetch(path);
          
          if (response.ok) {
            const content = await response.text();
            debugLog(`✅ Tải thành công từ: ${path}`);
            return { success: true, path: path, content: content };
          }
        } catch (error) {
          debugLog(`❌ Không thể tải từ ${path}:`, error.message);
        }
      }
      
      return { success: false, error: 'Không thể tải từ bất kỳ đường dẫn nào' };
    }

    async function loadProductData() {
      debugLog('Bắt đầu tải dữ liệu sản phẩm...');
      
      const result = await tryFetchMultiplePaths(CONFIG.jsonPaths);
      
      if (!result.success) {
        throw new Error(result.error);
      }

      try {
        const data = JSON.parse(result.content);
        debugLog('Đã parse JSON thành công', { 
          hasProducts: !!data.products, 
          productCount: data.products ? data.products.length : 0 
        });

        if (!data.products || !Array.isArray(data.products)) {
          throw new Error('Định dạng JSON không hợp lệ - thiếu mảng products');
        }

        if (data.products.length === 0) {
          throw new Error('Không có sản phẩm nào trong file JSON');
        }

        // Log danh sách sản phẩm để debug
        debugLog('Danh sách sản phẩm:', data.products.map(p => ({ id: p.id, name: p.name })));

        return data.products;
      } catch (error) {
        throw new Error(`Lỗi parse JSON: ${error.message}`);
      }
    }

    function findProductById(products, productId) {
      debugLog(`Tìm sản phẩm với ID: ${productId}`);
      
      // Thử tìm với nhiều cách so sánh
      let product = products.find(p => p.id == productId); // So sánh lỏng lẻo
      
      if (!product) {
        product = products.find(p => p.id === parseInt(productId)); // So sánh chặt chẽ
      }
      
      if (!product) {
        product = products.find(p => p.id.toString() === productId); // So sánh string
      }

      debugLog('Kết quả tìm kiếm:', product ? `Tìm thấy: ${product.name}` : 'Không tìm thấy');
      
      return product;
    }

    function generateStarRating(rating) {
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 !== 0;
      let stars = '';
      
      for (let i = 0; i < fullStars; i++) {
        stars += '<i class="fas fa-star"></i>';
      }
      
      if (hasHalfStar) {
        stars += '<i class="fas fa-star-half-alt"></i>';
      }
      
      const emptyStars = 5 - Math.ceil(rating);
      for (let i = 0; i < emptyStars; i++) {
        stars += '<i class="far fa-star"></i>';
      }
      
      return stars;
    }

    // ==================== DISPLAY FUNCTIONS ====================
    function displayProduct(product) {
      if (!product) {
        showError('Sản phẩm không tồn tại', `Không tìm thấy sản phẩm với ID: ${new URLSearchParams(window.location.search).get('id')}`);
        return;
      }

      debugLog('Bắt đầu hiển thị sản phẩm:', product.name);

      const productPage = document.getElementById('productPage');
      
      try {
        // Tạo HTML cho sản phẩm
        productPage.innerHTML = `
          <div class="product-gallery">
            <div class="gallery-main">
              <img src="${product.images?.[0] || 'https://via.placeholder.com/600x600/FFF9F9/E6A6B0?text=Ảnh+sản+phẩm'}" 
                   alt="${product.name}" 
                   id="main-image">
            </div>
            <div class="gallery-thumbnails" id="galleryThumbnails">
              ${(product.images || []).map((image, index) => `
                <img src="${image}" 
                     alt="Image ${index + 1}" 
                     class="thumbnail ${index === 0 ? 'active' : ''}">
              `).join('')}
            </div>
          </div>

          <div class="product-details">
            <h1 class="product-title">${product.name || 'Không có tên'}</h1>
            <div class="product-brand">${product.brand || 'Không có thương hiệu'}</div>
            
            <div class="product-rating">
              <div class="rating-stars">
                ${generateStarRating(product.rating || 0)}
              </div>
              <div class="rating-value">${(product.rating || 0).toFixed(1)}/5</div>
            </div>
            
            ${product.isNew ? `<p class="new-arrival">New Arrival - Launched: ${product.launchDate ? new Date(product.launchDate).toLocaleDateString('vi-VN') : 'Không có ngày'}</p>` : ''}

            <div class="product-pricing">
              ${product.originalPrice ? `<span class="original-price">$${(product.originalPrice || 0).toFixed(2)}</span>` : ''}
              <span class="sale-price">$${(product.price || 0).toFixed(2)}</span>
            </div>

            <p class="shipping-note">Shipping calculated at checkout.</p>

            ${product.shades ? `
            <div class="product-options">
              <label for="product-variant">Shade</label>
              <select id="product-variant">
                ${product.shades.map(shade => `
                  <option value="${shade.value}">${shade.label}</option>
                `).join('')}
              </select>
            </div>
            ` : ''}

            <p class="product-description">
              ${product.detailedDescription || product.description || 'Không có mô tả'}
            </p>

            <div class="quantity-selector">
              <button class="quantity-btn" id="decrease-qty">-</button>
              <input type="number" id="quantity" value="1" min="1">
              <button class="quantity-btn" id="increase-qty">+</button>
            </div>

            <button class="btn-primary" id="addToCartBtn">ADD TO CART</button>
          </div>
        `;
          window.currentProduct = product;

        // Hiển thị thông tin mở rộng với các section riêng biệt
        displayExtendedInfo(product);
        
        // Khởi tạo sự kiện
        initializeProductEvents(product);

        debugLog('✅ Hiển thị sản phẩm thành công');

      } catch (error) {
        showError('Lỗi khi hiển thị sản phẩm', error.message);
      }
    }

    function displayExtendedInfo(product) {
      const infoEnhanced = document.getElementById('productInfoEnhanced');
      
      if (!product.ingredientsInfo && !product.shadeInfo && !product.benefits && !product.reviews) {
        infoEnhanced.innerHTML = '<p style="text-align: center; color: var(--text-light); font-size: 18px;">Không có thông tin bổ sung cho sản phẩm này.</p>';
        return;
      }

      let html = '';

      // Section Rating Breakdown
      html += `
        <div class="rating-breakdown">
          <div class="section-header">
            <div class="section-icon">⭐</div>
            <h2 class="section-title">Customer Ratings</h2>
          </div>
          <div class="rating-overview">
            <div class="rating-score">
              <div class="rating-number">${(product.rating || 4.5).toFixed(1)}</div>
              <div class="rating-stars-large">${generateStarRating(product.rating || 4.5)}</div>
              <div class="rating-count">${product.reviews?.length || 12} reviews</div>
            </div>
            <div class="rating-bars">
              ${generateRatingBars(product.ratingDistribution || [15, 25, 40, 15, 5])}
            </div>
          </div>
          <div class="rating-summary">
            <div class="summary-item">
              <span class="summary-label">Overall Rating</span>
              <span class="summary-value">${(product.rating || 4.5).toFixed(1)} out of 5</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Would Recommend</span>
              <span class="summary-value">${product.recommendationRate || 92}%</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Value for Money</span>
              <span class="summary-value">${(product.valueRating || 4.3).toFixed(1)}/5</span>
            </div>
          </div>
        </div>
      `;

      // Section Ingredients & Texture
      if (product.ingredientsInfo || product.ingredientList || product.textureInfo) {
        html += `
          <div class="info-section">
            <div class="section-header">
              <div class="section-icon">🧪</div>
              <h2 class="section-title">Ingredients & Texture</h2>
            </div>
            ${product.ingredientsInfo ? `<p style="font-size: 18px; margin-bottom: 20px;">${product.ingredientsInfo}</p>` : ''}
            ${product.ingredientList ? `
              <div class="ingredients-list">
                ${product.ingredientList.map(item => {
                  const [key, ...valueParts] = item.split(':');
                  const value = valueParts.join(':').trim();
                  return `
                    <div class="ingredient-item">
                      <div class="ingredient-name">${key.trim()}</div>
                      <div class="ingredient-purpose">${value}</div>
                    </div>
                  `;
                }).join('')}
              </div>
            ` : ''}
            ${product.textureInfo ? `<p style="font-size: 18px; margin-top: 20px;">${product.textureInfo}</p>` : ''}
          </div>
        `;
      }

      // Section Shade Range & Undertones
      if (product.shadeInfo || product.shadeList) {
        html += `
          <div class="info-section">
            <div class="section-header">
              <div class="section-icon">🎨</div>
              <h2 class="section-title">Shade Range & Undertones</h2>
            </div>
            ${product.shadeInfo ? `<p style="font-size: 18px; margin-bottom: 20px;">${product.shadeInfo}</p>` : ''}
            ${product.shadeList ? `
              <ul class="features-list">
                ${product.shadeList.map(item => {
                  const [key, ...valueParts] = item.split(':');
                  const value = valueParts.join(':').trim();
                  return `
                    <li class="feature-item">
                      <div class="feature-badge">${key.trim().charAt(0)}</div>
                      <div class="feature-content">
                        <h4>${key.trim()}</h4>
                        <p>${value}</p>
                      </div>
                    </li>
                  `;
                }).join('')}
              </ul>
            ` : ''}
          </div>
        `;
      }

      // Section Benefits
      if (product.benefits) {
        html += `
          <div class="info-section">
            <div class="section-header">
              <div class="section-icon">✨</div>
              <h2 class="section-title">Benefits</h2>
            </div>
            <div class="benefits-grid">
              ${product.benefits.map(benefit => {
                const [key, ...valueParts] = benefit.split(':');
                const value = valueParts.join(':').trim();
                return `
                  <div class="benefit-card">
                    <div class="benefit-icon">★</div>
                    <h3 class="benefit-title">${key.trim()}</h3>
                    <p class="benefit-description">${value}</p>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      }

      // Section Reviews & Ratings
      html += `
        <div class="reviews-section">
          <div class="reviews-header">
            <div>
              <div class="reviews-average">
                ${generateStarRating(product.rating || 4.5)}
                <span>${(product.rating || 4.5).toFixed(1)}/5</span>
              </div>
              <div class="reviews-count">(${product.reviews?.length || 12} reviews)</div>
            </div>
            <button class="btn-primary" style="padding: 10px 20px; font-size: 16px;">Write a Review</button>
          </div>
          <div class="reviews-list">
            ${generateSampleReviews(product.reviews || []).join('')}
          </div>
        </div>
      `;

      infoEnhanced.innerHTML = html;
      
      // Animate rating bars after they're added to DOM
      setTimeout(animateRatingBars, 300);
    }

    function generateRatingBars(distribution) {
      const total = distribution.reduce((sum, value) => sum + value, 0);
      const percentages = distribution.map(value => Math.round((value / total) * 100));
      
      return `
        <div class="rating-bar">
          <span class="rating-label">5 Stars</span>
          <div class="rating-bar-container">
            <div class="rating-bar-fill" data-width="${percentages[4]}%" style="width: 0%"></div>
          </div>
          <span class="rating-percentage">${percentages[4]}%</span>
        </div>
        <div class="rating-bar">
          <span class="rating-label">4 Stars</span>
          <div class="rating-bar-container">
            <div class="rating-bar-fill" data-width="${percentages[3]}%" style="width: 0%"></div>
          </div>
          <span class="rating-percentage">${percentages[3]}%</span>
        </div>
        <div class="rating-bar">
          <span class="rating-label">3 Stars</span>
          <div class="rating-bar-container">
            <div class="rating-bar-fill" data-width="${percentages[2]}%" style="width: 0%"></div>
          </div>
          <span class="rating-percentage">${percentages[2]}%</span>
        </div>
        <div class="rating-bar">
          <span class="rating-label">2 Stars</span>
          <div class="rating-bar-container">
            <div class="rating-bar-fill" data-width="${percentages[1]}%" style="width: 0%"></div>
          </div>
          <span class="rating-percentage">${percentages[1]}%</span>
        </div>
        <div class="rating-bar">
          <span class="rating-label">1 Star</span>
          <div class="rating-bar-container">
            <div class="rating-bar-fill" data-width="${percentages[0]}%" style="width: 0%"></div>
          </div>
          <span class="rating-percentage">${percentages[0]}%</span>
        </div>
      `;
    }

    function animateRatingBars() {
      const ratingBars = document.querySelectorAll('.rating-bar-fill');
      ratingBars.forEach(bar => {
        const width = bar.getAttribute('data-width');
        setTimeout(() => {
          bar.style.width = width;
        }, 100);
      });
    }

  // ==================== SAMPLE REVIEWS BY CATEGORY ====================
const SAMPLE_REVIEWS = {
  makeup: [
    { name: "Isabella R.", rating: 5, text: "The finish is absolutely stunning — luminous yet natural." },
    { name: "Chloe M.", rating: 4, text: "Beautiful texture, feels high-end and blends like a dream." },
    { name: "Sophia D.", rating: 5, text: "One of the best luxury products I've tried. Worth every penny." },
    { name: "Emma J.", rating: 4, text: "Elegant packaging and a formula that truly performs." },
    { name: "Olivia K.", rating: 5, text: "Gives my skin such a soft-focus glow, love it!" },
    { name: "Mia T.", rating: 5, text: "Feels like silk on the skin — effortlessly flawless." },
    { name: "Luna V.", rating: 4, text: "The pigments are rich, and the scent feels luxurious." },
    { name: "Grace P.", rating: 5, text: "Truly a masterpiece — both in formula and design." },
    { name: "Ella F.", rating: 5, text: "Every use feels like a beauty ritual. Absolutely divine!" },
    { name: "Harper C.", rating: 4, text: "It’s luxurious and long-lasting — can’t ask for more!" }
  ],
  skincare: [
    { name: "Lily A.", rating: 5, text: "Leaves my skin radiant and deeply hydrated." },
    { name: "Sophie N.", rating: 4, text: "Soft texture, absorbs quickly without any stickiness." },
    { name: "Amelia G.", rating: 5, text: "My skin has never felt this smooth and fresh!" },
    { name: "Hazel L.", rating: 5, text: "A luxurious skincare essential — love the glow!" }
  ],
  perfume: [
    { name: "Nora S.", rating: 5, text: "An unforgettable scent — elegant and timeless." },
    { name: "Ava C.", rating: 5, text: "Smells like sophistication bottled up. Just perfect." },
    { name: "Ruby H.", rating: 4, text: "Subtle yet powerful. I get compliments all day." },
    { name: "Emily Z.", rating: 5, text: "The fragrance feels like pure luxury — a must-have." }
  ]
};

// ==================== RANDOM REVIEW GENERATOR ====================
function generateSampleReviews(reviews) {
  // Nếu sản phẩm có review thực tế thì giữ nguyên
  if (reviews && reviews.length > 0) {
    return reviews.map(review => `
      <div class="review-item">
        <div class="review-avatar">${review.name.charAt(0)}</div>
        <div class="review-content">
          <div class="review-header">
            <span class="review-name">${review.name}</span>
            <span class="review-date">${review.date || 'October 2025'}</span>
            <div class="review-stars">${generateStarRating(review.rating)}</div>
          </div>
          <p class="review-text">${review.text}</p>
          <div class="review-helpful">Was this helpful? <a href="#">Yes (5)</a> | <a href="#">No (0)</a></div>
        </div>
      </div>
    `);
  }

  // Nếu chưa có review → random 3 câu theo loại sản phẩm
  const category = (window.currentProduct?.category || 'makeup').toLowerCase();
  const pool = SAMPLE_REVIEWS[category] || SAMPLE_REVIEWS.makeup;

  // Lấy ngẫu nhiên 3 review không trùng
  const randomSet = [...pool].sort(() => Math.random() - 0.5).slice(0, 3);

  // Thêm ngày ngẫu nhiên
  const today = new Date();
  return randomSet.map((r, i) => {
    const date = new Date(today - i * 86400000 * (1 + Math.random() * 2));
    const dateStr = date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });

    return `
      <div class="review-item">
        <div class="review-avatar">${r.name.charAt(0)}</div>
        <div class="review-content">
          <div class="review-header">
            <span class="review-name">${r.name}</span>
            <span class="review-date">${dateStr}</span>
            <div class="review-stars">${generateStarRating(r.rating)}</div>
          </div>
          <p class="review-text">${r.text}</p>
          <div class="review-helpful">Was this helpful? <a href="#">Yes (3)</a> | <a href="#">No (0)</a></div>
        </div>
      </div>
    `;
  });
}


    function initializeProductEvents(product) {
      // Sự kiện thumbnail
      const thumbnails = document.querySelectorAll('.thumbnail');
      const mainImage = document.getElementById('main-image');
      
      thumbnails.forEach(thumb => {
        thumb.addEventListener('click', function() {
          mainImage.style.opacity = '0.5';
          setTimeout(() => {
            mainImage.src = this.src;
            mainImage.style.opacity = '1';
          }, 200);
          
          document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
          this.classList.add('active');
        });
      });

      // Sự kiện quantity selector
      const decreaseBtn = document.getElementById('decrease-qty');
      const increaseBtn = document.getElementById('increase-qty');
      const quantityInput = document.getElementById('quantity');
      
      if (decreaseBtn && increaseBtn && quantityInput) {
        decreaseBtn.addEventListener('click', function() {
          let value = parseInt(quantityInput.value);
          if (value > 1) {
            quantityInput.value = value - 1;
          }
        });

        increaseBtn.addEventListener('click', function() {
          let value = parseInt(quantityInput.value);
          if (value < 999) {
            quantityInput.value = value + 1;
          }
        });
      }

      // Sự kiện add to cart
      const addToCartBtn = document.getElementById('addToCartBtn');
      if (addToCartBtn) {
        addToCartBtn.addEventListener('click', function() {
          this.textContent = '✓ ADDED TO CART';
          this.style.background = 'var(--secondary-color)';
          setTimeout(() => {
            this.textContent = 'ADD TO CART';
            this.style.background = 'var(--gradient-pink)';
          }, 2000);
        });
      }
    }

    // ==================== HEADER/FOOTER LOADING ====================
    async function loadHeaderFooter() {
      debugLog('Bắt đầu tải header và footer...');
      
      try {
        // Tải header
        const headerResponse = await fetch(CONFIG.headerPath);
        if (headerResponse.ok) {
          const headerHTML = await headerResponse.text();
          document.getElementById('header-placeholder').innerHTML = headerHTML;
          debugLog('✅ Header loaded');
          // Re-init header logic sau khi chèn
          initHeader();
        } else {
          throw new Error(`HTTP ${headerResponse.status}`);
        }
      } catch (error) {
        debugLog('❌ Lỗi tải header:', error.message);
        document.getElementById('header-placeholder').innerHTML = `
          <div style="padding: 20px; text-align: center; color: var(--text-light); font-size: 18px;">
            <p>Header không khả dụng</p>
          </div>
        `;
      }

      try {
        // Tải footer
        const footerResponse = await fetch(CONFIG.footerPath);
        if (footerResponse.ok) {
          const footerHTML = await footerResponse.text();
          document.getElementById('footer-placeholder').innerHTML = footerHTML;
          debugLog('✅ Footer loaded');
        } else {
          throw new Error(`HTTP ${footerResponse.status}`);
        }
      } catch (error) {
        debugLog('❌ Lỗi tải footer:', error.message);
        document.getElementById('footer-placeholder').innerHTML = `
          <div style="padding: 20px; text-align: center; color: var(--text-light); font-size: 18px;">
            <p>Footer không khả dụng</p>
          </div>
        `;
      }
    }

    // ===== HEADER INIT FUNCTION (to fix mobile nav dropdown) =====
    function initHeader() {
      // Elements for header (sau khi chèn)
      const menuToggler = document.getElementById('menu-toggler');
      const navbar = document.getElementById('navbar');
      const shopAll = document.querySelector('.shop-all');
      const menuCategories = document.querySelector('.menu-categories');
      const backBtn = document.querySelector('.back-btn');
      const nextButtons = document.querySelectorAll('.next-btn');
      const announcementWrapper = document.getElementById('announcementWrapper');
      const searchIcon = document.querySelector('.search .icon');
      const searchInput = document.getElementById('search-input-main');
      const searchOverlay = document.createElement('div');
      const searchWrapper = document.createElement('div');
      const searchInputOverlay = document.createElement('input');
      const closeSearch = document.createElement('button');

      // Setup search overlay
      searchOverlay.classList.add('search-overlay');
      searchWrapper.classList.add('search-wrapper');
      searchInputOverlay.classList.add('search-input');
      searchInputOverlay.placeholder = 'Search for...';
      closeSearch.classList.add('close-search');
      closeSearch.innerHTML = '&times;';
      searchWrapper.appendChild(searchInputOverlay);
      searchWrapper.appendChild(closeSearch);
      searchOverlay.appendChild(searchWrapper);
      document.body.appendChild(searchOverlay);

      // Debounce function for resize
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // Toggle menu
      if (menuToggler && navbar) {
        menuToggler.addEventListener('click', (e) => {
          e.stopPropagation();
          const isActive = navbar.classList.contains('active');
          navbar.classList.toggle('active', !isActive);
          navbar.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
          navbar.style.transform = isActive ? 'translateY(-100%)' : 'translateY(0)';
          navbar.style.opacity = isActive ? '0' : '1';
          document.body.style.overflow = isActive ? '' : 'hidden';
          if (!isActive) {
            if (shopAll) shopAll.classList.remove('active');
            if (menuCategories) {
              menuCategories.classList.remove('active');
              menuCategories.style.display = 'none';
              document.querySelectorAll('.category').forEach(cat => {
                cat.classList.remove('active');
                const productList = cat.querySelector('.product-list');
                if (productList) productList.style.display = 'none';
              });
            }
          } else {
            restoreScroll();
          }
        });

        // Click outside to close menu on mobile
        document.addEventListener('click', (e) => {
          if (
            window.innerWidth <= 900 &&
            !navbar.contains(e.target) &&
            !menuToggler.contains(e.target) &&
            navbar.classList.contains('active')
          ) {
            navbar.classList.remove('active');
            navbar.style.transform = 'translateY(-100%)';
            navbar.style.opacity = '0';
            if (shopAll) shopAll.classList.remove('active');
            if (menuCategories) {
              menuCategories.classList.remove('active');
              menuCategories.style.display = 'none';
              document.querySelectorAll('.category').forEach(cat => {
                cat.classList.remove('active');
                const productList = cat.querySelector('.product-list');
                if (productList) productList.style.display = 'none';
              });
            }
            restoreScroll();
          }
        });
      }

      // Toggle categories
      if (shopAll && menuCategories) {
        let timeoutId;

        const handleMouseEnter = () => {
          clearTimeout(timeoutId);
          if (window.innerWidth > 900) {
            menuCategories.style.display = 'block';
            menuCategories.style.opacity = '1';
            menuCategories.style.transform = 'translateY(0)';
            // Hiển thị tất cả product-list trên PC
            document.querySelectorAll('.category').forEach(cat => {
              cat.classList.add('active');
              const productList = cat.querySelector('.product-list');
              if (productList) productList.style.display = 'block';
            });
          }
        };

        const handleMouseLeave = () => {
          timeoutId = setTimeout(() => {
            if (window.innerWidth > 900) {
              menuCategories.style.display = 'none';
              menuCategories.style.opacity = '0';
              menuCategories.style.transform = 'translateY(-10px)';
              // Ẩn tất cả product-list khi rời chuột
              document.querySelectorAll('.category').forEach(cat => {
                cat.classList.remove('active');
                const productList = cat.querySelector('.product-list');
                if (productList) productList.style.display = 'none';
              });
            }
          }, 300);
        };

        if (window.innerWidth > 900) {
          shopAll.addEventListener('mouseenter', handleMouseEnter);
          shopAll.addEventListener('mouseleave', handleMouseLeave);
          menuCategories.addEventListener('mouseenter', handleMouseEnter);
          menuCategories.addEventListener('mouseleave', handleMouseLeave);
        }

        shopAll.addEventListener('click', (e) => {
          if (window.innerWidth <= 900) {
            e.preventDefault();
            e.stopPropagation();
            const isActive = shopAll.classList.contains('active');
            shopAll.classList.toggle('active', !isActive);
            menuCategories.classList.toggle('active', !isActive);
            menuCategories.style.display = menuCategories.classList.contains('active') ? 'flex' : 'none';
            menuCategories.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            menuCategories.style.opacity = isActive ? '0' : '1';
            menuCategories.style.transform = isActive ? 'translateY(-10px)' : 'translateY(0)';
            if (backBtn) {
              backBtn.style.display = menuCategories.classList.contains('active') ? 'flex' : 'none';
            }
          }
        });

        if (backBtn) {
          backBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            shopAll.classList.remove('active');
            menuCategories.classList.remove('active');
            menuCategories.style.display = 'none';
            menuCategories.style.opacity = '0';
            menuCategories.style.transform = 'translateY(-10px)';
            backBtn.style.display = 'none';
            document.querySelectorAll('.category').forEach(cat => {
              cat.classList.remove('active');
              const productList = cat.querySelector('.product-list');
              if (productList) productList.style.display = 'none';
            });
            restoreScroll();
          });
        }

        function setupMobileCategoryInteractions() {
          nextButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
              e.stopPropagation();
              const category = btn.closest('.category');
              const isActive = category.classList.contains('active');
              document.querySelectorAll('.category').forEach(cat => {
                if (cat !== category) {
                  cat.classList.remove('active');
                  const productList = cat.querySelector('.product-list');
                  if (productList) productList.style.display = 'none';
                }
              });
              category.classList.toggle('active', !isActive);
              const productList = category.querySelector('.product-list');
              if (productList) {
                productList.style.display = category.classList.contains('active') ? 'block' : 'none';
                productList.style.transition = 'opacity 0.3s ease';
                productList.style.opacity = category.classList.contains('active') ? '1' : '0';
              }
            });
          });

          document.querySelectorAll('.category-header').forEach(header => {
            header.addEventListener('click', (e) => {
              if (!e.target.closest('.next-btn') && !e.target.closest('a')) {
                e.stopPropagation();
                const category = header.closest('.category');
                const isActive = category.classList.contains('active');
                document.querySelectorAll('.category').forEach(cat => {
                  if (cat !== category) {
                    cat.classList.remove('active');
                    const productList = cat.querySelector('.product-list');
                    if (productList) productList.style.display = 'none';
                  }
                });
                category.classList.toggle('active', !isActive);
                const productList = category.querySelector('.product-list');
                if (productList) {
                  productList.style.display = category.classList.contains('active') ? 'block' : 'none';
                  productList.style.transition = 'opacity 0.3s ease';
                  productList.style.opacity = category.classList.contains('active') ? '1' : '0';
                }
              }
            });
          });
        }

        setupMobileCategoryInteractions();

        // Debounce resize event
        const handleResize = debounce(() => {
          if (window.innerWidth > 900) {
            shopAll.addEventListener('mouseenter', handleMouseEnter);
            shopAll.addEventListener('mouseleave', handleMouseLeave);
            menuCategories.addEventListener('mouseenter', handleMouseEnter);
            menuCategories.addEventListener('mouseleave', handleMouseLeave);
            shopAll.classList.remove('active');
            menuCategories.classList.remove('active');
            menuCategories.style.display = 'none';
            menuCategories.style.opacity = '0';
            menuCategories.style.transform = 'translateY(-10px)';
            if (backBtn) backBtn.style.display = 'none';
            document.querySelectorAll('.category').forEach(cat => {
              cat.classList.remove('active');
              const productList = cat.querySelector('.product-list');
              if (productList) productList.style.display = 'none';
            });
            navbar.classList.remove('active');
            navbar.style.transform = 'translateY(0)';
            navbar.style.opacity = '1';
            restoreScroll();
          } else {
            shopAll.removeEventListener('mouseenter', handleMouseEnter);
            shopAll.removeEventListener('mouseleave', handleMouseLeave);
            menuCategories.removeEventListener('mouseenter', handleMouseEnter);
            menuCategories.removeEventListener('mouseleave', handleMouseLeave);
            menuCategories.style.transform = 'translateY(0)';
            // Đảm bảo product-list ẩn trên mobile khi resize
            document.querySelectorAll('.category').forEach(cat => {
              cat.classList.remove('active');
              const productList = cat.querySelector('.product-list');
              if (productList) productList.style.display = 'none';
            });
          }
        }, 100);

        window.addEventListener('resize', handleResize);
      }

      function restoreScroll() {
        document.body.style.overflow = '';
      }

      // Announcement slide
      if (announcementWrapper) {
        let currentSlide = 0;
        const slides = announcementWrapper.children;
        let slideInterval;

        function startSlide() {
          slideInterval = setInterval(() => {
            currentSlide = (currentSlide + 1) % slides.length;
            announcementWrapper.style.transition = 'transform 0.8s ease-in-out';
            announcementWrapper.style.transform = `translateX(-${currentSlide * 100}%)`;
          }, 3000);
        }

        startSlide();

        announcementWrapper.addEventListener('mouseenter', () => {
          clearInterval(slideInterval);
        });

        announcementWrapper.addEventListener('mouseleave', () => {
          startSlide();
        });
      }

      // Search overlay
      if (searchIcon && searchInput) {
        searchIcon.addEventListener('click', () => {
          searchOverlay.classList.add('active');
          searchInputOverlay.focus();
          document.body.style.overflow = 'hidden';
        });

        closeSearch.addEventListener('click', () => {
          searchOverlay.classList.remove('active');
          document.body.style.overflow = '';
        });

        searchInputOverlay.addEventListener('input', () => {
          const query = searchInputOverlay.value.toLowerCase();
          searchInput.value = query;
          if (window.filterProducts) window.filterProducts(query);
        });
      }
    }

    // ==================== MAIN INITIALIZATION ====================
    async function initializePage() {
      debugLog('🚀 Bắt đầu khởi tạo trang...');
      
      try {
        // Tải header và footer
        await loadHeaderFooter();
        
        // Adjust padding dynamically
        const main = document.querySelector("main");
        function adjustPadding() {
          const header = document.querySelector("#header-placeholder header");
          if (header && main) {
            const headerHeight = header.offsetHeight;
            main.style.paddingTop = (headerHeight + 40) + "px";
          }
        }

        // Lặp kiểm tra cho đến khi header được load xong
        const observer = new MutationObserver(() => {
          adjustPadding();
        });

        const headerPlaceholder = document.querySelector("#header-placeholder");
        if (headerPlaceholder) {
          observer.observe(headerPlaceholder, { childList: true, subtree: true });
        }

        window.addEventListener("resize", adjustPadding);
        adjustPadding(); // Initial call

        // Lấy ID sản phẩm từ URL
        const productId = getProductIdFromURL();
        if (!productId) return;
        
        // Hiển thị loading
        showLoading();
        
        // Tải dữ liệu sản phẩm
        debugLog('🔄 Đang tải dữ liệu sản phẩm...');
        const products = await loadProductData();
        
        if (!products) {
          showError('Không thể tải dữ liệu sản phẩm');
          return;
        }

        // Tìm và hiển thị sản phẩm
        debugLog(`🔍 Đang tìm sản phẩm với ID: ${productId}`);
        const product = findProductById(products, productId);
        displayProduct(product);
        
        // Cập nhật tiêu đề trang
        if (product) {
          document.title = `${product.name} - ${product.brand} | Flower Knows`;
        }
        
        debugLog('✅ Khởi tạo trang hoàn tất');

      } catch (error) {
        console.error('💥 Lỗi khởi tạo trang:', error);
        showError('Lỗi khi tải trang', error.message);
      }
    }

    // ==================== ERROR HANDLING ====================
    window.addEventListener('error', function(e) {
      console.error('🚨 Lỗi toàn cục:', e.error);
    });

    window.addEventListener('unhandledrejection', function(e) {
      console.error('🚨 Promise bị từ chối:', e.reason);
    });

    // Khởi chạy
    document.addEventListener('DOMContentLoaded', initializePage);
  </script>
</body>
</html>